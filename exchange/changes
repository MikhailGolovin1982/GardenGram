from telethon import TelegramClient, events
from config import API_ID, API_HASH, PHONE_NUMBER, SESSION_FILE

# ID –≥—Ä—É–ø–ø—ã (—Å -100)
TARGET_CHAT = -1001460415788

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
KEYWORDS = [
    "—Å–ª–æ—Ç",
    "–º–∞–ª–∏–¥–∞–∫",
    "malidak"
]


client = TelegramClient(SESSION_FILE, API_ID, API_HASH)


@client.on(events.NewMessage(chats=TARGET_CHAT))
async def handler(event):
    message_text = event.raw_text.lower()

    if any(keyword in message_text for keyword in KEYWORDS):
        sender = await event.get_sender()
        print("\nüîî –ù–∞–π–¥–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:")
        print(f"–û—Ç: {sender.first_name}")
        print(f"–¢–µ–∫—Å—Ç: {event.raw_text}")
        print("-" * 40)


async def main():
    print("–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Telegram...")
    await client.start(phone=PHONE_NUMBER)

    me = await client.get_me()
    print(f"–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –∫–∞–∫: {me.first_name} (id={me.id})")

    print("–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ...")
    await client.run_until_disconnected()


if __name__ == "__main__":
    with client:
        client.loop.run_until_complete(main())
